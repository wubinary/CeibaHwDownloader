(()=>{var e="downloadEveryoneOption",n=window.location.href.includes("all=1");document.getElementById("nav_sect").innerHTML+='\n    <li>\n        |\n        <a href="#" id="download_all_hw" >'+(n?"[Download all]":"[List all]")+"</a>\n    </li>\n",document.getElementById("sect_cont").innerHTML=(n?'\n    <div style="border-width:3px;border-style:dashed;border-color:#42650F;padding:5px;">\n        [Download all] options: <br>\n            &emsp; Everyones : <input id="downloadEveryoneOption" type="checkbox" checked> <br>\n            &emsp; --------------------- <br>\n            &emsp; On time only: <input id="downloadOntimeOption" type="checkbox"> <br>\n            &emsp; Delayed only: <input id="downloadDelayedOption" type="checkbox"> <br>\n            <br>\n        Meta CSV: <br>\n            &emsp; Download meta CSV: <input id="downloadMetaCSV" type="checkbox" onclick="return false;" checked> <br>\n            <br>\n        <progress id="downloadProgress" value="100" max="100"> </progress>\n    </div>\n    <br>\n':"")+document.getElementById("sect_cont").innerHTML;const t=n=>{e=n,["downloadEveryoneOption","downloadOntimeOption","downloadDelayedOption"].forEach((n=>{document.getElementById(n).checked=n===e}))};document.getElementById("download_all_hw").addEventListener("click",(async()=>{if(!window.location.href.includes("all=1"))return void window.open("https://ceiba.ntu.edu.tw/course_admin/hw/index.php?op=hw_corr_list&all=1&sort=");let n=document.getElementsByTagName("table")[0].getElementsByTagName("caption")[0].innerText.replace("批改作業: ",""),t=Array.from(document.getElementsByTagName("tr")),o=[];for(let n=0;n<t.length;n++){let a=Array.from(t[n].getElementsByTagName("td"));if(0===a.length)continue;let[l,i,c,r,m,s]=[a[2].getElementsByTagName("input")[0].value,a[3].getElementsByTagName("span")[0].innerText,a[7].getElementsByTagName("a")[0].href,a[6].getElementsByTagName("span")[0].innerText,"expr"===a[6].getElementsByTagName("span")[0].className?"late":"",""];r&&("downloadEveryoneOption"===e||"downloadOntimeOption"===e&&!m||"downloadDelayedOption"===e&&m)&&(d=c,window.open(d).blur(),s="v"),o.push([l,i,r,m,s]),document.getElementById("downloadProgress").value=Math.ceil(n/t.length*100)}var d;((e,n,t)=>{let o=[];n.forEach((function(e,n){var t=e.join(",");o.push(0==n?"data:text/csv; charset=utf-8,\ufeffstuID, stuName, submitTime, late, downloaded, \n"+t:t)}));let d=o.join("\n"),a=encodeURI(d),l=document.createElement("a");l.href=a,l.download="CeibaHWDownload_"+t+".csv",document.body.append(l),l.click(),document.body.removeChild(l)})(0,o,n)})),n&&(document.getElementById("downloadEveryoneOption").addEventListener("change",(function(){this.checked?t("downloadEveryoneOption"):t("")})),document.getElementById("downloadOntimeOption").addEventListener("change",(function(){this.checked?t("downloadOntimeOption"):t("")})),document.getElementById("downloadDelayedOption").addEventListener("change",(function(){this.checked?t("downloadDelayedOption"):t("")})))})();